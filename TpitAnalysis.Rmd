---
title: "TpitReport"
author: "W. McDonald"
date: "2/24/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goal

The goal of this document is to reproducibly import, wrangle and analyse the full pituitary adenoma tissue microarray dataset, including all immunostains up to *Tpit*. *CAM5.2* staining pattern is included, as a relavant categorical variable. Otherwise, IHC staining extant and intensity are reported as Allred scores as previously published. 

This analysis will rely on the tools of the tidyverse, when possible. 

## Data import, wrangling.

```{r}
library(tidyverse)
library(gridExtra)

patma <- read_csv("data/TpitAddedDx")

patma %>%
  count(newDx, sort = TRUE)

patma %>%
  group_by(newDx) %>%
  summarize(mean(TSHMedian, na.rm = TRUE))
```

## IHC by diagnosis box plots, scatter plots

A basic understanding of the staining patterns is an important first step. 

Multiple ways to display these in a grid. The gridExtra package is pretty simple. See [this useful vignette](https://cran.r-project.org/web/packages/egg/vignettes/Ecosystem.html).

```{r}
p<-ggplot(patma, aes(newDx, TPITMedian))
p1 <- p + geom_point(position=position_jitter(width=0.3, height=0.1)) +
  theme_minimal() +
  coord_flip() +
  labs(x="Diagnostic Class") +
  labs(y="Allred Score") +
  labs(title="Tpit Median IHC Score")

p<-ggplot(patma, aes(newDx, SF1Median))
p2 <- p + geom_point(position=position_jitter(width=0.3, height=0.1)) +
  theme_minimal() +
  coord_flip() +
  labs(x="Diagnostic Class") +
  labs(y="Allred Score") +
  labs(title="SF-1 Median IHC Score")

p<-ggplot(patma, aes(newDx, Pit1Median))
p3 <- p + geom_point(position=position_jitter(width=0.3, height=0.1)) +
  theme_minimal() +
  coord_flip() +
  labs(x="Diagnostic Class") +
  labs(y="Allred Score") +
  labs(title="Pit-1 Median IHC Score")

grid.arrange(p1, p2, p3, nrow = 1)

```


## Correlation matrix and p values for the correlations

Beyond the R help documentation for cor(), I like the visualizations from [this site](http://www.sthda.com/english/wiki/visualize-correlation-matrix-using-correlogram)

Explore these!

```{r}
library(corrplot)
patma %>% 
  select(SF1Median, Pit1Median, TPITMedian, PRLMedian, GHMedian, TSHMedian, LHMedian, FSHMedian, ACTHMedian) %>% 
  cor(y = NULL, use = "complete.obs", method = "pearson") %>% 
  round(2)

M <- patma %>% 
  select(SF1Median, Pit1Median, TPITMedian, PRLMedian, GHMedian, TSHMedian, LHMedian, FSHMedian, ACTHMedian, ASUMedian, GATA3Median) %>% 
  cor(y = NULL, use = "complete.obs", method = "pearson")

corrplot(M, type = "upper", order = "hclust")

library(Hmisc)

pvalues <- patma %>% 
  select(SF1Median, Pit1Median, TPITMedian, PRLMedian, GHMedian, TSHMedian, LHMedian, FSHMedian, ACTHMedian, ASUMedian, GATA3Median) %>% 
  cor(y = NULL, use = "complete.obs", method = "pearson") %>%
  as.matrix() %>%
  rcorr()

pvalues

```

## HIERARCHICAL CLUSTERING

```{r}

```

## K-means cluster analysis and display using clusplot()

```{r}

```

## PRINCIPLE COMPONENT ANALYSIS (PCA)
```{r}

```

## FACTOR ANALYSIS
```{r}

```

## Classification trees

```{r}

```


